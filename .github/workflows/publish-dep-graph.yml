name: Publish dep-graph

on:
  workflow_dispatch:
  pull_request:
    types: [opened, synchronize]

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  publish-dep-graph:
    runs-on: ubuntu-latest
    continue-on-error: true
    steps:
      - name: Check out repository
        uses: actions/checkout@v1
      - name: Use Node (v14.16.0)
        uses: actions/setup-node@v1
        with:
          node-version: v14.16.0
      - name: Install Yarn
        run: npm install -g yarn
      - name: Install dependencies
        run: yarn
      - name: Run nx dep-graph
        run: yarn nx affected:dep-graph --file=tmp/dep-graph/index.html
